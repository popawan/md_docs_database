flowchart TD
    n1["梁寧莉GPTS"] --> n2["與女主聊天拍照"] & n3["與女主合照"] & n4["拍女主"]
    n4 --> n9["拍照"]
    n6["選角度"] --> n8["拍照"]
    n7["第一次拍照地點附近5個背景（A~F）"] --> n8
    n3 --> n10["邀請使用者上傳圖片（內容不拘）"]
    n8 --> n11["第一次拍照地點附近5個背景（A~F）"] & n12["選角度（0~9）"] & n13["拍照"]
    n11 --> n13
    n12 --> n13
    n9 --> n7 & n6 & n8
    n2 --> n14["聊天"] & n15["拍照"]
    n15 --> n14 & n16["聊天"] & n17["聊天"]
    n14 --> n16
    n16 --> n17
    n10 --> n18["合照"]
    n18 --> n19["繼續合照"]

    n1@{ shape: rounded}





# Taiwan Ai Chat — GPTS 全功能規格與驗收手冊  
**版本**：v1.0  
**日期**：2025-08-28  
**維護者**：阿旺（產品負責人）｜ChatGPT（系統整合）

---

## 1. 核心目標
這份 README 確保跨聊天、跨版本的**延續性**，避免功能被破壞或流程遺失。  
包含：**功能標準、驗收條件、架構、測試清單**。

---

## 2. 功能標準（Definition of Done）

### 2.1 角色設定
- 名稱：梁寧莉（Ning-Li）
- 身份：20 歲台日混血設計系學生
- 語氣：自然、溫柔、繁體中文  
- 禁用詞：AI、合成、生成等相關詞彙

---

### 2.2 三大模式

#### (A) 拍照模式（PRO）
> **主流程**  
1. 使用者可隨時按 **Q** 拍照  
2. 拍照後 → 必出「角度選單」  
3. 選角度後 → 必出「背景選單」  
4. 再次按 **Q** → 持續拍照，**回到角度選單循環**  
5. 同角度每次拍照需有**不同姿勢與微表情**

**角度編號（必固定）**
| 選項 | 描述 |
|------|------|
| 1    | 左45° |
| 2    | 左90° |
| 3    | 左135° |
| 4    | 背影 |
| 5    | 右45° |
| 6    | 右90° |
| 7    | 右135° |
| 8    | 仰視 |
| 9    | 俯視 |
| 0    | 跳過 |

**背景選單（A~E，隨機5個台灣景點）**  
> 例：A. 西門町紅樓 | B. 淡水漁人碼頭 | C. 九份老街 | D. 象山夜景 | E. 台北101  
**0=跳過**

**姿勢變化**
- 即使同角度，需利用 `pose_tick` 綁定隨機種子，強制出現**肩線微動作、表情變化**。

---

#### (B) 合照模式（DUO）
1. 需先上傳使用者自拍（安全內容）。  
2. 按 **Q** → 生成「梁寧莉＋使用者」合照  
3. 背景預設台灣場景，**可隨機或之後支援選單**  
4. 之後可連拍，**不必再次上傳自拍**

---

#### (C) 聊天拍照（CHAT）  
> **狀態：尚未驗收**  
- 只能用**當前對話場景**或**女主引導地點**  
- 拍照後同樣進入「角度＋背景選單循環」  
- 不允許跳躍到不相關地點

---

## 3. 驗收條件（Acceptance Criteria）

### 3.1 PRO 模式
- [ ] 第一次 Q → 拍照成功  
- [ ] 拍照後必出角度選單（1~9/0）  
- [ ] 選完角度 → 必出背景選單（A~E/0）  
- [ ] 連拍時可直接 Q → 再次進入角度選單循環  
- [ ] 同角度連拍 ≥3 張時，照片需有姿勢/表情差異

### 3.2 DUO 模式
- [ ] 未上傳自拍時，按 Q 提示自然  
- [ ] 上傳自拍後，Q → 合照正常生成  
- [ ] Q 可持續連拍且沿用自拍

### 3.3 CHAT 模式（下一輪驗收）
- [ ] 地點來自對話或女主引導  
- [ ] 第一次 Q 可拍照  
- [ ] 拍照後可進角度/背景選單循環

---

## 4. 程式架構

##5.目前工作日誌
# 📸 module_pro 拍照模組操作流程日誌
> **版本**：v3.6.0  
> **日期**：2025/08/29  
> **功能範圍**：僅限拍照模組（`module_pro`），其他功能未更動

---

## **1. 功能概述**
`module_pro` 是專門為「女主拍照」設計的互動模組，核心特點：
- 使用者可 **自由組合** 角度、背景與快門
- **只有按下 Enter 才會生效**
- 按 `Q` 快門可隨時續拍，不會強制重新設定
- 完整角度與背景選單，**不會丟失其他功能設定**

---

## **2. 模組狀態機制**

| 狀態名稱       | 說明                               |
|---------------|------------------------------------|
| `idle`        | 等待使用者輸入                     |
| `angle`       | 進入角度選單                        |
| `bg`          | 進入背景選單                        |
| `busy`        | 拍照中，會忽略所有輸入               |

---

## **3. 使用者輸入邏輯**

### **3.1 三大輸入類型**
#### 角度（輸入 0～9）
| 數字 | 說明       | 視角解讀 |
|------|------------|-----------|
| 0    | 跳過       | 沿用上次設定 |
| 1    | 左45°      | 正面偏左 |
| 2    | 左90°      | 側臉左邊 |
| 3    | 左135°     | 後腦勺 + 左臉頰 |
| 4    | 背影       | 背向鏡頭 |
| 5    | 右45°      | 正面偏右 |
| 6    | 右90°      | 側臉右邊 |
| 7    | 右135°     | 後腦勺 + 右臉頰 |
| 8    | 仰視       | 從下往上拍 |
| 9    | 俯視       | 從上往下拍 |

#### 背景（輸入 A～E）
| 字母 | 地點        |
|------|------------|
| 0    | 跳過      |
| A    | 西門紅樓   |
| B    | 台北101   |
| C    | 淡水海邊   |
| D    | 九份老街   |
| E    | 花蓮七星潭 |

#### 快門（按 Q）
- 單獨 `Q` → 直接拍照
- Q 不會立刻觸發，**需要 Enter**
- 沿用上次角度與背景

---

## **4. 自由組合輸入規則**

> **核心原則**：**順序不限**，解析在 Enter 觸發

| 範例輸入 | 系統解析 | 行為 |
|----------|----------|------|
| `2bq` | 角度=2、背景=B → 拍照 | 設定角度2 + 背景B，拍照 |
| `q2b` | 角度=2、背景=B → 拍照 | Q 在最前，但等 Enter 才拍 |
| `b3q` | 角度=3、背景=B → 拍照 | 設定背景B + 角度3，拍照 |
| `qb2` | 角度=2、背景=B → 拍照 | 輸入順序不同，結果一致 |
| `q` | 沿用上次設定 → 拍照 | 單純續拍 |

---

## **5. 操作流程**

### **① 進入拍照模式**
**觸發指令**：  
「拍照」 / 「女主拍」 / 「幫你拍」

**系統回覆**：
🎯 先幫我決定；或直接按『Q』快門 📷

1️⃣ 角度（輸入 0～9；0=跳過）
1左45°｜2左90°｜3左135°｜4背影｜5右45°｜6右90°｜7右135°｜8仰視｜9俯視
2️⃣ 背景（輸入 A～E；0=跳過）
A西門紅樓｜B台北101｜C淡水海邊｜D九份老街｜E花蓮七星潭
3️⃣ 直接按『Q』快門 📷
💡 可一次輸入（順序不限）：2bq｜b3q｜q2b｜qb2｜q

---

### **② 拍照完成**
**系統回覆**：
📸 拍好了！

1️⃣ 角度（輸入 0～9；0=跳過）
1左45°｜2左90°｜3左135°｜4背影｜5右45°｜6右90°｜7右135°｜8仰視｜9俯視
2️⃣ 背景（輸入 A～E；0=跳過）
A西門紅樓｜B台北101｜C淡水海邊｜D九份老街｜E花蓮七星潭
3️⃣ 直接按『Q』快門 📷
💡 可一次輸入（順序不限）：2bq｜b3q｜q2b｜qb2｜q

---

### **③ 續拍 / 調整設定**
- 選角度 → 輸入 `1-9`
- 選背景 → 輸入 `A-E`
- 沿用設定 → 按 `Q`
- 一次設定 → `2bq`、`qb2`、`b3q` 等

---

## **6. 注意事項**
- **phrases.json** 僅新增拍照模組提示，不影響其他功能
- **router.yaml** 僅改拍照模組邏輯
- **Q** 不會自動拍照，**必須 Enter 確認**
- 完整支援續拍、角度背景切換與自由組合

- ## 2025-08-29 專拍（拍女主）體驗規則與落地做法

### 一、互動原則（不可破壞的體驗）
1. 三行必備菜單（任一輪拍完後都要出）
   - ① 角度（1～9；含 3/7 的「後腦勺＋左右臉頰」註解）
   - ② 背景（A～E：附近 5 地點示例；也能直接輸入地點名）
   - ③ 直接拍照（Q）
2. 使用者可隨時直接按 Q 拍；也可先挑角度或背景再拍。
3. 角度與背景都要**可反覆調整**；不能因為選了角度就把背景功能收走，反之亦然。
4. 支援組合輸入（順序不限）：例如 `2bq`、`b3q`、`qb2`、`q`。
   - 有 `q` 代表立即拍；沒有 `q` 則只記錄設定並展示菜單。
5. 角度定義（需明示）
   - 左/右 135°：可見後腦勺＋對應側臉頰（左/右）。
6. 首次拍照後也**必定**回到三行菜單；不可只說「拍好了」而不給選項。

### 二、穩定性與回退策略
1. 不移除既有功能；採「保留舊區塊＋開關切換」。
2. `phrases.json` 內保留 v1 舊文案區塊，使用 `feature_flags.pro_ui = 'v2' | 'v1'` 切換。
3. 任何問題需要回退，只改 `feature_flags` 即可，**不刪檔**、**不搬家**。

### 三、檔案與模組邊界
- `phrases.json`：只增文案與註記；舊文案完整保留（disabled）。
- `module_pro.yaml`：只新增三行菜單顯示與「組合輸入」步驟，不動其餘模組。
- `router.yaml`：只保留基本路由，不改合照/聊天拍照等其他模組。

### 四、驗收清單
- [ ] 首次拍照後，出現三行菜單（角度/背景/Q）。
- [ ] 任意選擇角度或背景後，仍回到三行菜單。
- [ ] `2bq / b3q / qb2 / q` 等組合能被正確解析；帶 `q` 立即快門。
- [ ] 角度 3/7 的說明文字正確顯示（後腦勺＋左右臉頰）。
- [ ] 任意時刻輸入 Q 都能拍照，且拍完回到三行菜單。

ChatGPT 說：
2025-08-30｜拍照模組（PRO）驗收前日工作日誌（整合版｜一鍵貼上）

負責：阿旺（驗收）／我（程式修改）
範圍：僅 module_pro（拍女主）；不動 DUO（合照）／CHAT（聊天拍照）與其字庫
目標：任何操作後（尤其出圖後）都必定顯示「三行完整選單」（角度｜背景｜直接按 Q），以一致文案引導確保穩定體驗
結論：採「不追 bug、統一輸出」策略完成今日修整；明日依腳本驗收

🔒 原則（今日共識）

不做大修／不改其他功能：只動 module_pro；不觸碰 DUO／CHAT。

不追 bug、先統一輸出：誰發話都顯示同一套正確選單，玩家不會困惑。

字庫不污染：phrases.json 使用阿旺提供版；不得縮減或誤用他模組字串。

可回退：所有新說明以註解保留舊句；出問題可一鍵還原。

模組獨立：Router 只分流；三模組互不干涉。

體驗優先：先確保顯示正確操作（角度/背景/Q），再談根因。

背景相近：A～E 來自當下照片地點附近五個推薦點（無定位則安全 fallback）。

角色語氣保護：不改聊天字庫與人設口吻。

版本＋日誌：每次修改標註版本與日期。

驗收後鎖檔：PRO 通過後即凍結，再進 DUO → CHAT 驗收。

🔁 驗收流程（簡潔循環）

進入 PRO（拍照｜女主拍｜幫你拍）→ 顯示三行選單

Q（快門）→ 出圖 → 三行選單

Q（連拍）→ 出圖 → 三行選單

1（角度）→ 三行選單（角度 0～9 說明完整，含 3/7 後腦勺＋側臉頰）

2（背景）→ 三行選單（A～E 為附近五地點）

2bq / b3q / qb2 / q 任意順序 → 直接出圖 → 三行選單

任何「搶話」或舊提示出現，也要呈現同一套三行（本輪策略）。

✅ 驗收條件（對照）

首次 Q 可拍照成功；拍後出角度/背景/Q 三行。

任意時刻 Q 可續拍；拍後回三行。

角度 3/7 說明文字正確（後腦勺＋對應側臉頰）。

背景 A～E 會依當下照片地點列出附近五點。

同角度連拍 ≥3 張，姿勢/表情有微差（pose_tick 自增）。

📜 明日驗收腳本（照表執行）

輸入 拍照 → 出三行選單

Q → 出圖 → 三行選單

Q → 再出圖 → 三行選單（A～E 可能更新）

1 → 出三行選單（角度說明完整）

2 → 出三行選單（A～E 為附近五地點）

2bq（或 b3q / qb2）→ 直接出圖 → 三行選單

同角度連拍 3 張 → 觀察微表情/肩線變化

🧩 今日修改（只限 PRO）

檔案：module_pro.yaml → v3.9.4（2025-08-30）

on_success：強制輸出三行完整選單（角度｜背景 A～E｜Q），附組合範例。

背景 A～E：nearby(@kb.backgrounds.pool, inferred_location, 5)；無定位 sample(@kb.backgrounds.pool, 5)。

組合輸入：2bq / b3q / qb2 / q 任意順序支援。

可回退：舊說明保留為註解，不破壞原檔。

字庫引用：僅讀本次提供的鍵：

ui.first_shot_hint / ui.after_adjust_hint / ui.direct_q_hint

angles.menu_title / angles.labels[0..9]

backgrounds_ui.menu_title（A～E 地名由模組動態填入）

字庫：phrases.json 使用阿旺剛提供之版本（原樣保留，不再修改）

🧯 風險控管／回退策略

若仍見非預期句子：不追根因，把該出口也改為同一套三行選單（僅限 PRO），確保玩家無感。

若需回退：只回退 module_pro.yaml 上一版；字庫不動。

驗收通過後：鎖定 PRO，再進 DUO → CHAT。

🗂 變更清單

修改：module_pro.yaml → v3.9.4（今日版）。

保留：phrases.json（以你提供版為準，未更動）。

未改：module_duo.yaml、module_chat.yaml、Router 分流規則。

📝 今日紀錄（時間序）

確認驗收口徑：三行選單循環與附近 5 地點。

修正只限 PRO；不動 DUO/CHAT。

還原 phrases.json 為你提供版本；禁止污染別模組字串。

推出 module_pro.yaml v3.9.4：出圖後固定三行、背景動態、組合輸入、保留註解。

因速限暫停驗收，改明日按腳本全程測。

📌 三行選單標準文案（對齊口徑）

行 1｜角度
0 跳過｜1 左45°（左前方）｜2 左90°（側臉）｜3 左135°（後腦勺+左臉頰）｜4 背影｜5 右45°（右前方）｜6 右90°（側臉）｜7 右135°（後腦勺+右臉頰）｜8 仰視｜9 俯視
行 2｜背景
A 地點1｜B 地點2｜C 地點3｜D 地點4｜E 地點5（當下附近五地點）
行 3｜快門
③ 直接拍照：按『Q』（範例：2bq、b3q、qb2、q）

# Create the integrated work log as a markdown file and save it for download
content = """# 2025-08-30｜拍照模組（PRO）驗收前日工作日誌（整合版）

**負責**：阿旺（驗收）／我（程式修改）  
**範圍**：僅 `module_pro`（拍女主）；**不動** DUO（合照）／CHAT（聊天拍照）與其字庫  
**目標**：任何操作後（尤其出圖後）都**必定**顯示「三行完整選單」（角度｜背景｜直接按 Q），以一致文案引導確保穩定體驗  
**結論**：採「**不追 bug、統一輸出**」策略完成今日修整；明日依腳本驗收

---

## 🔒 原則（今日共識）
1. **不做大修／不改其他功能**：只動 `module_pro`；不觸碰 DUO／CHAT。  
2. **不追 bug、先統一輸出**：誰發話都顯示同一套正確選單，玩家不會困惑。  
3. **字庫不污染**：`phrases.json` 使用阿旺提供版；不得縮減或誤用他模組字串。  
4. **可回退**：所有新說明以註解保留舊句；出問題可一鍵還原。  
5. **模組獨立**：Router 只分流；三模組互不干涉。  
6. **體驗優先**：先確保顯示正確操作（角度/背景/Q），再談根因。  
7. **背景相近**：A～E 來自**當下照片地點附近**五個推薦點（無定位則安全 fallback）。  
8. **角色語氣保護**：不改聊天字庫與人設口吻。  
9. **版本＋日誌**：每次修改標註版本與日期。  
10. **驗收後鎖檔**：PRO 通過後即凍結，再進 DUO → CHAT 驗收。

---

## 🔁 驗收流程（簡潔循環）
- 進入 PRO（`拍照｜女主拍｜幫你拍`）→ 顯示三行選單  
- `Q`（快門）→ 出圖 → **三行選單**  
- `Q`（連拍）→ 出圖 → **三行選單**  
- `1`（角度）→ **三行選單**（角度 0～9 說明完整，含 3/7 後腦勺＋側臉頰）  
- `2`（背景）→ **三行選單**（A～E 為附近五地點）  
- `2bq / b3q / qb2 / q` 任意順序 → 直接出圖 → **三行選單**

> 任何「搶話」或舊提示出現，也要呈現**同一套三行**（本輪策略）。

---

## ✅ 驗收條件（對照）
- 首次 `Q` 可拍照成功；**拍後**出角度/背景/Q 三行。  
- 任意時刻 `Q` 可續拍；**拍後**回三行。  
- 角度 3/7 說明文字正確（後腦勺＋對應側臉頰）。  
- 背景 A～E 會依**當下照片地點**列出附近五點。  
- 同角度連拍 ≥3 張，**姿勢/表情**有微差（`pose_tick` 自增）。

---

## 📜 明日驗收腳本（照表執行）
1. 輸入 `拍照` → 出**三行選單**  
2. `Q` → 出圖 → **三行選單**  
3. `Q` → 再出圖 → **三行選單**（A～E 可能更新）  
4. `1` → 出**三行選單**（角度說明完整）  
5. `2` → 出**三行選單**（A～E 為附近五地點）  
6. `2bq`（或 `b3q` / `qb2`）→ 直接出圖 → **三行選單**  
7. 同角度連拍 3 張 → 觀察**微表情/肩線**變化

---

## 🧩 今日修改（只限 PRO）
- **檔案**：`module_pro.yaml` → **v3.9.4（2025-08-30）**  
  - **on_success**：強制輸出三行完整選單（角度｜背景 A～E｜Q），附組合範例。  
  - **背景 A～E**：`nearby(@kb.backgrounds.pool, inferred_location, 5)`；無定位 `sample(@kb.backgrounds.pool, 5)`。  
  - **組合輸入**：`2bq / b3q / qb2 / q` 任意順序支援。  
  - **可回退**：舊說明保留為註解，不破壞原檔。  
  - **字庫引用**：僅讀本次提供的鍵：  
    - `ui.first_shot_hint / ui.after_adjust_hint / ui.direct_q_hint`  
    - `angles.menu_title / angles.labels[0..9]`  
    - `backgrounds_ui.menu_title`（A～E 地名由模組動態填入）

- **字庫**：`phrases.json` 使用阿旺剛提供之版本（**原樣保留，不再修改**）

---

## 🧯 風險控管／回退策略
- 若仍見非預期句子：**不追根因**，把該出口也改為**同一套三行選單**（僅限 PRO），確保玩家無感。  
- 若需回退：只回退 `module_pro.yaml` 上一版；**字庫不動**。  
- 驗收通過後：**鎖定 PRO**，再進 DUO → CHAT。

---

## 🗂 變更清單
- **修改**：`module_pro.yaml` → v3.9.4（今日版）。  
- **保留**：`phrases.json`（以你提供版為準，未更動）。  
- **未改**：`module_duo.yaml`、`module_chat.yaml`、Router 分流規則。

---

## 📝 今日紀錄（時間序）
- 確認驗收口徑：三行選單循環與附近 5 地點。  
- 修正只限 PRO；**不動** DUO/CHAT。  
- 還原 `phrases.json` 為你提供版本；禁止污染別模組字串。  
- 推出 `module_pro.yaml v3.9.4`：出圖後固定三行、背景動態、組合輸入、保留註解。  
- 因速限暫停驗收，改明日按腳本全程測。

---

## 📌 三行選單標準文案（對齊口徑）
**行 1｜角度**  
`0 跳過｜1 左45°（左前方）｜2 左90°（側臉）｜3 左135°（後腦勺+左臉頰）｜4 背影｜5 右45°（右前方）｜6 右90°（側臉）｜7 右135°（後腦勺+右臉頰）｜8 仰視｜9 俯視`  
**行 2｜背景**  
`A 地點1｜B 地點2｜C 地點3｜D 地點4｜E 地點5`（**當下附近五地點**）  
**行 3｜快門**  
`③ 直接拍照：按『Q』`（**範例**：`2bq、b3q、qb2、q`）
"""
path = "/mnt/data/2025-08-30_PRO_驗收前日工作日誌.md"
with open(path, "w", encoding="utf-8") as f:
    f.write(content)
path
# Build a full-feature verification pack covering PRO / DUO / CHAT
# Includes: principles, router isolation checks, per-mode acceptance criteria, scripts, edge cases,
# cross-mode interference checks, rollback plan, and a logging template.
# Save as downloadable Markdown.

fullpack = """# 2025-08-30｜GPTS 全功能驗收套件（PRO＋DUO＋CHAT）

**負責**：阿旺（驗收）／我（程式修改）  
**涵蓋**：拍女主（PRO）｜合照（DUO）｜聊天拍照（CHAT）  
**總原則**：不做大修、不改其他功能的行為邏輯；先以「不追 bug、統一輸出」確保穩定體驗；每一模組獨立驗收、獨立鎖檔。

---

## 🧭 全域原則（跨模組）
1. **模組獨立、Router 只分流**：`拍照/女主拍/幫你拍 → PRO`；`合照 → DUO`；`聊天拍/聊天 → CHAT`。  
2. **不追 bug、統一輸出**：任何異常出口先顯示正確操作選單（各模組自己的三行/提示），避免體驗漂移。  
3. **字庫不污染**：`phrases.json` 三模組字串獨立使用；不得縮減、混用或覆蓋他模組字串。  
4. **可回退**：所有新文案以註解保留舊句；出現問題可一鍵還原。  
5. **版本與日誌**：每一改動標註版號與日期，記錄於工作日誌。  
6. **鎖檔節奏**：PRO → DUO → CHAT，逐一通過就鎖檔，後續驗收不受前模組波動影響。

---

## 🔌 Router 隔離檢查（先做這個）
- 輸入 `拍照` 應只進 PRO；輸入 `合照` 應只進 DUO；輸入 `聊天拍` 應只進 CHAT。  
- 在各模組流程中，按 `Q` 的行為**不得**跳模組或觸發他模組文案。  
- 驗證「忙碌鎖（busy）」：拍攝進行中忽略其他輸入；完成後恢復選單。  
- 若發現跨模組文案出現 → **不追根因**，先將該出口文案覆寫為當前模組的正確提示。

---

## ✅ 驗收條件匯總（Definition of Done）
### PRO（拍女主）
- 首次 `Q` 成功出圖；**拍後必出三行選單**（角度0~9/背景A~E/按Q）。  
- 背景 A～E 取**當下照片地點附近** 5 點（無定位則安全 fallback）。  
- 任意時刻 `Q` 能續拍；拍後回三行選單。  
- 角度 3/7 說明文字正確（後腦勺＋對應側臉頰）。  
- 同角度連拍 ≥3 張，**pose_tick** 帶來表情/肩線微差。

### DUO（合照）
- 未上傳自拍：按 `Q` 給**自然提示**（請先上傳自拍）。  
- 上傳自拍後：`Q` 生成**「寧莉＋使用者」**合照；**不允許**角度/背景選單（避免與 PRO 混淆）。  
- 連拍：上傳後可直接 `Q` 續拍，沿用同一張自拍（直到使用者更換）。  
- 背景：預設台灣場景（可隨機或之後支援選單，但**本輪不出選單**）。

### CHAT（聊天拍照）— 下一輪驗收
- 地點來源：**當前對話場景**或**女主引導地點**，不得跳躍到不相關地點。  
- `Q` 可拍；拍後進入**角度＋背景選單循環**，但背景**僅限當前/引導地點相關**。  
- 不顯示 DUO 的上傳自拍提示；不顯示 PRO 的附近 A～E 若不相符。

---

## 🧪 驗收腳本（逐步操作｜可逐條勾選）

### A. PRO（拍女主）
1. `拍照` → 顯示三行選單（角度/背景/按Q）。 ☐  
2. `Q` → 出圖 → 顯示三行選單。 ☐  
3. `Q` → 再出圖 → 顯示三行選單（A～E 可能更新）。 ☐  
4. `1` → 三行選單中角度說明完整（含 3/7 註解）。 ☐  
5. `2` → 三行選單中背景 A～E 為**當下附近五地點**。 ☐  
6. `2bq`（或 `b3q` / `qb2`）→ 直接出圖 → 三行選單。 ☐  
7. 同角度連拍 ≥3 張，檢查微表情/肩線變化。 ☐  

> 出現非預期文案：就地覆寫成 PRO 的三行選單，不追根因。

### B. DUO（合照）
1. `合照`（未上傳自拍）→ 按 `Q` 提示「請先上傳自拍」。 ☐  
2. 上傳一張自拍（安全內容）。 ☐  
3. `Q` → 生成「寧莉＋使用者」合照；**無角度/背景選單**。 ☐  
4. `Q`（連拍）→ 不需重傳自拍，持續生成合照。 ☐  
5. 任意步驟不得出現 PRO 的角度/背景選單或 CHAT 的地點限制文案。 ☐  

> 出現非預期文案：就地覆寫成 DUO 的正確提示（例如「已使用你的自拍，按 Q 續拍」）。

### C. CHAT（聊天拍照）— 下一輪（先列腳本，明日/後天執行）
1. `聊天拍` → 由當前對話推斷地點（或女主引導）。 ☐  
2. `Q` → 出圖；背景應符合**當前/引導地點**。 ☐  
3. 拍後顯示角度＋背景選單，但**背景候選限該地點範圍**。 ☐  
4. 任意步驟不得出現 DUO 的自拍提示或 PRO 的「附近 A～E（與當下地點無關）」清單。 ☐  

> 出現非預期文案：就地覆寫成 CHAT 的地點受限選單。

---

## 📎 三行選單標準文案（PRO 專用）
- **角度**：`0 跳過｜1 左45°（左前方）｜2 左90°（側臉）｜3 左135°（後腦勺+左臉頰）｜4 背影｜5 右45°（右前方）｜6 右90°（側臉）｜7 右135°（後腦勺+右臉頰）｜8 仰視｜9 俯視`  
- **背景**：`A 地點1｜B 地點2｜C 地點3｜D 地點4｜E 地點5`（**當下附近五地點**）  
- **快門**：`③ 直接拍照：按『Q』`（例：`2bq、b3q、qb2、q`）

---

## 🧯 異常處理策略（不追 bug、先穩體驗）
- 在**當前模組**範圍內，將任何異常出口全部覆寫為該模組的正確提示（PRO 三行／DUO 自拍流程／CHAT 地點受限）。  
- 僅當跨模組干擾被證實時，記錄干擾點與輸出字串，作為後續技術修補的依據。

---

## 🔙 回退策略
- 任何異常，先**回退當前模組檔案**至上版；字庫 `phrases.json` 不動。  
- PRO 驗收通過後**鎖檔**，避免再次影響 DUO／CHAT。

---

## 🧾 驗收紀錄模板（每輪一頁，貼入工作日誌）

- **日期**：2025-08-__  
- **模組**：□ PRO □ DUO □ CHAT  
- **步驟與結果**：  
  - [ ] 1. __________ → 結果：__________ 截圖：__________  
  - [ ] 2. __________ → 結果：__________ 截圖：__________  
  - [ ] 3. __________ → 結果：__________ 截圖：__________  
- **異常輸出（若有）**：  
  - 出口位置：__________  
  - 實際文案：__________  
  - 覆寫為：__________（當前模組標準提示）  
- **結論**：□ 通過 □ 待改 □ 需回退  
- **備註**：___________________________________________

---

## 📌 附：Router 快速冒煙測試（10 分鐘）
- `拍照` 後只能走 PRO；`Q` 不得觸發 DUO/CHAT 文案。  
- `合照` 後只能走 DUO；未上傳自拍按 `Q` 僅提示上傳；上傳後 `Q` 直接合照。  
- `聊天拍` 後只能走 CHAT；`Q` 僅使用當前/引導地點。

---

> **提醒**：明天驗收先跑「Router 隔離檢查」→ 再依 A（PRO）→ B（DUO）→ C（CHAT）順序走表；每步結果請記錄於「驗收紀錄模板」。通過的模組立即鎖檔。"""

out = "/mnt/data/2025-08-30_全功能驗收套件_PRO_DUO_CHAT.md"
with open(out, "w", encoding="utf-8") as f:
    f.write(fullpack)

out
