# Extend /mnt/data/tw_places.json with a larger curated list of youth-popular TW spots.
import json, os

path = "/mnt/data/tw_places.json"

# Load existing
data = {"pool": [], "chat_presets": []}
if os.path.exists(path):
    try:
        with open(path, "r", encoding="utf-8") as f:
            data = json.load(f)
            if "pool" not in data or not isinstance(data["pool"], list):
                data["pool"] = []
            if "chat_presets" not in data or not isinstance(data["chat_presets"], list):
                data["chat_presets"] = []
    except Exception:
        data = {"pool": [], "chat_presets": []}

def dedup(seq):
    out, seen = [], set()
    for x in seq:
        if x not in seen:
            seen.add(x); out.append(x)
    return out

# Curated additions grouped by city/area
by_city = {
    "台北": [
        "華山文創園區","松菸文創園區","赤峰街","中山站小巷咖啡","永康街","大稻埕·迪化街",
        "西門町","士林夜市","饒河街夜市","臨江街夜市","象山步道","貓空纜車·貓空",
        "北投圖書館","艋舺龍山寺周邊","故宮博物院週邊咖啡","建國花市"
    ],
    "新北": [
        "淡水老街","八里左岸","九份老街","十分老街","猴硐貓村","深澳鐵道自行車",
        "鶯歌老街","新店碧潭","三芝淺水灣","林口三井OUTLET"
    ],
    "基隆": ["基隆廟口夜市","正濱漁港彩色屋","和平島公園"],
    "桃園": ["大溪老街","青埔高鐵·華泰名品城","中壢夜市"],
    "新竹": ["新竹城隍廟小吃圈","新竹動物園·公園","關新路咖啡街"],
    "苗栗": ["勝興車站","南庄老街","龍騰斷橋"],
    "台中": [
        "審計新村","草悟道","勤美誠品綠園道","宮原眼科","一中街商圈","彩虹眷村",
        "高美濕地"
    ],
    "彰化": ["鹿港老街","扇形車庫"],
    "雲林": ["北港朝天宮周邊","虎尾糖廠"],
    "嘉義": ["檜意森活村","文化路夜市","蘭潭月影潭心"],
    "台南": [
        "神農街","正興街","藍曬圖文創園區","林百貨","國華街小吃","安平老街",
        "台南美術館周邊"
    ],
    "高雄": [
        "駁二藝術特區","哈瑪星·打狗鐵道故事館","高雄流行音樂中心周邊",
        "內惟藝術中心","蓮池潭","鹽埕埔老街"
    ],
    "屏東": ["墾丁大街","恆春老街","海生館周邊"],
    "宜蘭": ["幾米廣場","羅東夜市","礁溪溫泉街","冬山河親水公園"],
    "花蓮": ["東大門夜市","花蓮文創園區","七星潭"],
    "台東": ["鐵花村音樂聚落","台東美術館周邊","都蘭小鎮"],
    "南投": ["日月潭","清境農場","埔里紙教堂"],
    "澎湖": ["中央老街","篤行十村","觀音亭·彩虹橋"],
    "金門": ["模範街","翟山坑道"],
    "馬祖": ["北竿芹壁聚落","南竿大漢據點"]
}

# Priority presets (front of list) – popular & neutral for autoset
priority = [
    "華山文創園區","中山站小巷咖啡","赤峰街","松菸文創園區",
    "大稻埻·迪化街","西門町","審計新村","草悟道",
    "神農街","正興街","駁二藝術特區","高美濕地"
]

# Normalize a typo (大稻埕 vs 大稻埻)
priority = [p.replace("大稻埻","大稻埕") for p in priority]

# Merge pool
pool = list(data.get("pool", []))
for city, places in by_city.items():
    pool.extend(places)
pool = dedup(pool)

# Merge chat_presets: ensure priority first, then keep existing, then fill from pool
chat_presets = []
chat_presets.extend(priority)
chat_presets.extend(data.get("chat_presets", []))
# Add a few safe, broad-audience extras
extras = ["淡水老街","九份老街","審計新村","國華街小吃","藍曬圖文創園區","安平老街","蓮池潭","東大門夜市"]
chat_presets.extend(extras)
# Complete with pool to ensure coverage
chat_presets.extend(pool)
chat_presets = dedup(chat_presets)

# Attach by_city for future logic (non-breaking)
data["pool"] = pool
data["chat_presets"] = chat_presets
data["by_city"] = by_city
data["_meta"] = {
    "note": "擴充台灣年輕人常去的場景詞庫；僅供聊天模組 autoset/地點鎖定使用。",
    "updated_by": "assistant",
    "version_hint": "1.1",
    "keys": ["pool","chat_presets","by_city"],
    "safe_defaults": {
        "autoset_source": "chat_presets",
        "max_autoset_try": 1
    }
}

with open(path, "w", encoding="utf-8") as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

path
