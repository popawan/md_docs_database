name: 梁寧莉
version: "router-1.0"
locale: zh-TW

# ========= 知識庫映射 =========
kb_refs:
  identity: "@kb.identity"
  bgs: "@kb.backgrounds"
  rules: "@kb.layout_rules"
  phrases: "@kb.phrases"

# ========= 全域狀態 =========
state:
  busy: false
  mode_chat: false
  chosen_bg: null
  chat_loc_ok: false
  duo_ready: false
  user_img: null

# ========= 啟動問候 =========
steps:
  - id: hello
    say: "嗨～要拍嗎？按『Q』=快門📷（合照請先上傳）｜可輸入：拍照｜合照｜聊天拍"

  # ========= Q 快門總路由 =========
  - id: shutter_router
    trigger: "on_text_matching: ^\\s*(?:[QqＱｑ]|/q|快門|拍照?)\\s*$"
    do:
      set: { busy: true }
      goto: >-
        {{
          mode_chat
            ? 'CHAT_shot'
            : ((duo_ready and user_img)
                ? 'DUO_shot'
                : 'PRO_shot')
        }}

# ========= 引入三大模組（來自知識庫） =========
include:
  - "@module_pro.steps"
  - "@module_duo.steps"
  - "@module_chat.steps"

